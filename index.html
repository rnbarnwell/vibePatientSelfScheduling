<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <title>Acme Urgent Care — Book Your Appointment</title>

  <!-- Material Web (MD3) via esm.run for fast prototyping -->
  <script type="module">
    import "https://esm.run/@material/web/all.js";
  </script>

  <style>
    :root { --md-sys-color-primary:#0b6b50; }
    *{box-sizing:border-box}
    body { margin:0; font-family:system-ui,Roboto,Arial,sans-serif; }
    main.app { display:grid; grid-template-columns:minmax(280px,420px) 1fr; gap:28px; padding:20px; max-width:1200px; margin:auto; }
    @media(max-width:900px){ main.app { grid-template-columns:1fr; } }

    .card { background:#fff; border-radius:16px; padding:24px; box-shadow:0 2px 8px rgba(0,0,0,.08); display:flex; flex-direction:column; gap:10px; }

    /* Calendar */
    .calendar-header { display:grid; grid-template-columns:40px 1fr 40px; align-items:center; gap:8px; }
    .weekday-row, .days-grid { display:grid; grid-template-columns:repeat(7,1fr); gap:6px; text-align:center; }
    .weekday-row div { font-size:12px; font-weight:600; color:#555; }
    .daybtn { display:grid; place-items:center; aspect-ratio:1/1; border:0; border-radius:10px; background:#f3f3f3; cursor:pointer; font-weight:600; }
    .daybtn[disabled]{opacity:.35;cursor:not-allowed}

    /* Slots */
    .slot-list { display:grid; gap:10px; max-height:60vh; overflow-y:auto; overflow-x:hidden; }
    .slot-btn { all:unset; display:block; width:100%; max-width:100%; box-sizing:border-box; cursor:pointer; background:#fff; border-radius:12px; padding:10px 12px; border:1px solid rgba(0,0,0,.15); box-shadow:0 1px 0 rgba(0,0,0,.08); }
    .slot-btn .txt { font-weight:600; color: #0b6b50; }
    .slot-btn:hover { background: rgba(11,107,80,.06); }
    .slot-btn[aria-checked="true"]{ border-color:#0b6b50; box-shadow:0 0 0 2px rgba(11,107,80,.25) inset; }

    /* Form */
    form.form { display:flex; flex-direction:column; gap:18px; margin-top:12px; }
    .grid-2 { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
    @media(max-width:720px){ .grid-2 { grid-template-columns:1fr; } }
    fieldset { border:1px solid #ccc; border-radius:8px; padding:12px; margin:0; display:flex; flex-direction:column; gap:8px; }
    legend { font-weight:600; padding:0 6px; }
    .helper { font-size:13px; color:#555; margin-top:-6px; }
    md-outlined-text-field, md-outlined-select, md-filled-button { width:100%; }
    .pill { display:inline-flex; align-items:center; gap:8px; padding:10px 12px; border-radius:10px; background: rgba(11,107,80,.12); }
    .radio-group { display:flex; flex-direction:column; gap:6px; }

    /* DOB layout (flex, compact) */
    .dob-row { display:flex; gap:12px; align-items:flex-start; flex-wrap:nowrap; }
    .dob-row md-outlined-select,
    .dob-row md-outlined-text-field { width:96px !important; max-width:96px !important; flex:0 0 96px; display:block; }
    #dobYear { width:120px !important; max-width:120px !important; }
    @media(max-width:720px){
      .dob-row { flex-wrap:wrap; }
      .dob-row md-outlined-select, .dob-row md-outlined-text-field { width:100% !important; max-width:100% !important; flex:1 1 auto; }
    }

    /* Phone row wrappers for robust sizing */
    .phone-row { display:grid; grid-template-columns: 160px minmax(0, 360px); column-gap: 60px; align-items: start; }
    .phone-cell { min-width: 0; display:block; }
    .phone-cell--code { width:160px; min-width:160px; overflow:visible; padding-top:2px; padding-right:6px; }
    .phone-cell--num  { min-width:0; max-width:360px; }
    .phone-row md-outlined-select,
    .phone-row md-outlined-text-field { width:100%; display:block; box-sizing:border-box; }
    @media(max-width:720px){
      .phone-row { grid-template-columns: 1fr; row-gap:8px; }
      .phone-cell--code { width:120px; min-width:120px; }
      .phone-cell--num  { max-width:100%; }
    }

    /* Progress indicator */
    .progress { display:flex; align-items:center; gap:8px; margin-bottom:6px; }
    .circle { width:28px; height:28px; border-radius:50%; background:#ccc; color:#fff; display:flex; align-items:center; justify-content:center; font-weight:600; }
    .line { flex:0 0 40px; height:4px; background:#ccc; }
    .active { background:#0b6b50 !important; }
    /* Narrow, aligned phone row without changing markup */

    /* Inline error text styling */
    .error-msg {
      color:#b3261e;
      font-size:12px;
      margin-top:4px;
    }
    .progress-row { display:grid; grid-template-columns: 1fr auto 1fr; align-items:center; column-gap:12px; }
    .progress-row #backTop { justify-self:start; }
    .progress-row .progress { justify-self:center; }
     /* First row top margin without inline style */
    .form > .grid-2:first-child { margin-top:12px; }
    /* Visually enhanced brand */
    .brand { display:flex; align-items:center; gap:12px; margin-bottom:8px; }
    .brand-mark { width:44px; height:44px; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,.12); }
    .brand-text { line-height:1; }
    .brand-name { display:block; font-weight:900; letter-spacing:.6px; text-transform:uppercase; font-size:22px;
      background:linear-gradient(90deg,#0b6b50,#1aa179); -webkit-background-clip:text; background-clip:text; color:transparent; }
    .brand-sub { display:block; font-weight:700; font-size:14px; color:#0b6b50; letter-spacing:.2px; }
    /* sr-only utility for accessible hidden heading */
    .sr-only{position:absolute!important;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0 0 0 0);border:0}
    /* Tighter spacing between progress header and step titles */
    .card h2 { margin-top: 6px; }
    /* Step title hierarchy: Step 1 slightly larger than others */
    #step1 > h2 { font-size: clamp(20px, 2.2vw, 24px); }
    #step2 > h2, #step3 > h2, #step4 > h2 { font-size: clamp(18px, 2vw, 22px); }

    /* Tighter mobile spacing without affecting desktop */
    @media (max-width: 720px) {
      .card { gap: 8px; padding: 20px; }
      .progress { margin-bottom: 4px; }
      .card h2 { margin-top: 4px; }
    }
    /* Make the optional Details textarea resizable */
    textarea#details {
      width: 100%;
      min-height: 64px;
      max-height: 50vh;
      resize: vertical; /* user can drag bottom-right to resize */
      padding: 10px 12px;
      border: 1px solid rgba(0,0,0,.2);
      border-radius: 12px;
      background: #fff;
      font: inherit;
      box-sizing: border-box;
    }
    textarea#details:focus { outline: 2px solid rgba(11,107,80,.6); outline-offset: 2px; }
    /* Confirmation view styles */
    .confirm{display:grid;place-items:center;gap:14px;margin-top:8px;}
    .confirm-icon{width:56px;height:56px;border-radius:50%;background:rgba(11,107,80,.12);display:grid;place-items:center;}
    .confirm h2{margin:6px 0 0;}
    .confirm .lead{margin:0 0 8px;}
    .confirm-card{width:min(560px,100%);background:#f6f8f7;border:1px solid rgba(0,0,0,.08);border-radius:12px;padding:14px;}
    .confirm-card .row{display:flex;gap:10px;align-items:flex-start;margin-bottom:10px;}
    .confirm-card .row:last-child{margin-bottom:0;}
    .confirm-banner{width:min(560px,100%);background:rgba(11,107,80,.1);border-radius:8px;padding:10px;text-align:center;}
    /* Confirmation view styles */
    .confirm-icon span{ font-size:26px; color:#0b6b50; }
    .confirm-card .helper{ margin:0 0 2px; }
    .confirm-card .value{ font-weight:600; }
    /* Graceful focus ring for step titles */
    .card h2:focus { outline: none; }
    .card h2:focus-visible {
      outline: 2px solid rgba(11,107,80,.6);
      outline-offset: 2px;
      border-radius: 6px;
      box-shadow: 0 0 0 4px rgba(11,107,80,.12);
    }
  </style>
</head>
<body>
  <main class="app">
    <section class="clinic">
      <h1 class="sr-only">Acme Urgent Care</h1>
      <div class="brand" aria-label="Acme Urgent Care">
        <svg class="brand-mark" viewBox="0 0 64 64" role="img" aria-label="Acme Urgent Care logo">
          <defs>
            <linearGradient id="acmeGrad" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="#0b6b50"/>
              <stop offset="1" stop-color="#1aa179"/>
            </linearGradient>
          </defs>
          <!-- rounded square background -->
          <rect x="2" y="2" width="60" height="60" rx="12" fill="url(#acmeGrad)"/>
          <!-- white medical cross -->
          <path d="M28 14h8v14h14v8H36v14h-8V36H14v-8h14z" fill="#ffffff" opacity=".98"/>
        </svg>
        <div class="brand-text">
          <span class="brand-name">ACME</span>
          <span class="brand-sub">Urgent Care</span>
        </div>
      </div>
      <h2>Book your appointment</h2>
      <p>1 Main St, Anytown, MA, 01234</p>
      <p><b>Scheduling questions?</b></p>
      <p>We're here for you. Call us at 123 456 7890</p>
      <p>For immigration medical exams, please call us first. Thank you!</p>
    </section>

    <section class="card" aria-label="Appointment scheduling">
      <!-- Progress -->
      <div class="progress-row">
        <md-text-button id="backTop" type="button" aria-label="Go back" hidden>← Back</md-text-button>
        <div class="progress">
          <div id="circle1" class="circle">1</div>
          <div id="line1" class="line"></div>
          <div id="circle2" class="circle">2</div>
          <div id="line2" class="line"></div>
          <div id="circle3" class="circle">3</div>
          <div id="line3" class="line"></div>
          <div id="circle4" class="circle">4</div>
        </div>
        <span aria-hidden="true"></span>
      </div>

      <!-- Step 1 -->
      <div id="step1">
        <h2>Select a Date</h2>
        <div class="calendar-header">
          <button id="prev" type="button" aria-label="Previous month">◀</button>
          <div id="monthLabel"></div>
          <button id="next" type="button" aria-label="Next month">▶</button>
        </div>
        <div class="weekday-row" aria-hidden="true">
          <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
        </div>
        <div id="days" class="days-grid"></div>
      </div>

      <!-- Step 2 -->
      <div id="step2" hidden>
                <h2>Select a Time</h2>
        <div id="slotDateHeading"></div>
        <div id="slotList" class="slot-list" ></div>
      </div>

      <!-- Step 3 -->
      <div id="step3" hidden>
                <h2>Enter Your Details</h2>
        <div class="pill" id="apptSummary" aria-live="polite"></div>
        <form id="patientForm" class="form" novalidate>
          <div class="grid-2">
            <md-outlined-text-field id="firstName" label="Legal First Name *" required></md-outlined-text-field>
            <md-outlined-text-field id="lastName" label="Legal Last Name *" required></md-outlined-text-field>
          </div>

          <md-outlined-text-field id="email" type="email" label="Email *" required></md-outlined-text-field>

          <fieldset>
            <legend>Cell Phone Number *</legend>
            <div class="phone-row">
              <div class="phone-cell phone-cell--code">
                <md-outlined-select id="countryCode" label="Country code" required>
                  <md-select-option value="+1"><div slot="headline">+1 (United States)</div></md-select-option>
                  <md-select-option value="+61"><div slot="headline">+61 (Australia)</div></md-select-option>
                  <md-select-option value="+55"><div slot="headline">+55 (Brazil)</div></md-select-option>
                  <md-select-option value="+86"><div slot="headline">+86 (China)</div></md-select-option>
                  <md-select-option value="+33"><div slot="headline">+33 (France)</div></md-select-option>
                  <md-select-option value="+49"><div slot="headline">+49 (Germany)</div></md-select-option>
                  <md-select-option value="+91"><div slot="headline">+91 (India)</div></md-select-option>
                  <md-select-option value="+81"><div slot="headline">+81 (Japan)</div></md-select-option>
                  <md-select-option value="+52"><div slot="headline">+52 (Mexico)</div></md-select-option>
                  <md-select-option value="+31"><div slot="headline">+31 (Netherlands)</div></md-select-option>
                  <md-select-option value="+64"><div slot="headline">+64 (New Zealand)</div></md-select-option>
                  <md-select-option value="+63"><div slot="headline">+63 (Philippines)</div></md-select-option>
                  <md-select-option value="+65"><div slot="headline">+65 (Singapore)</div></md-select-option>
                  <md-select-option value="+82"><div slot="headline">+82 (South Korea)</div></md-select-option>
                  <md-select-option value="+34"><div slot="headline">+34 (Spain)</div></md-select-option>
                  <md-select-option value="+41"><div slot="headline">+41 (Switzerland)</div></md-select-option>
                  <md-select-option value="+44"><div slot="headline">+44 (United Kingdom)</div></md-select-option>
                </md-outlined-select>
              </div>
              <div class="phone-cell phone-cell--num">
                <md-outlined-text-field id="phone" label="Cell Phone Number *" placeholder="(555) 555-5555" required></md-outlined-text-field>
              </div>
            </div>
          </fieldset>
          <p class="helper">
            By entering your phone number, you consent to receive messages for this event via SMS.
            Message and data rates may apply. Reply STOP to opt out.
          </p>


          <fieldset>
            <legend>Address *</legend>
            <md-outlined-text-field id="addr1" label="Street Address" required></md-outlined-text-field>
            <md-outlined-text-field id="addr2" label="Apt, Suite, Unit (optional)"></md-outlined-text-field>
            <div class="grid-2">
              <md-outlined-text-field id="city" label="City" required></md-outlined-text-field>
              <md-outlined-select id="state" label="Select State" required>
                <md-select-option value="AL"><div slot="headline">AL</div></md-select-option>
                <md-select-option value="AK"><div slot="headline">AK</div></md-select-option>
                <md-select-option value="AZ"><div slot="headline">AZ</div></md-select-option>
                <md-select-option value="AR"><div slot="headline">AR</div></md-select-option>
                <md-select-option value="CA"><div slot="headline">CA</div></md-select-option>
                <md-select-option value="CO"><div slot="headline">CO</div></md-select-option>
                <md-select-option value="CT"><div slot="headline">CT</div></md-select-option>
                <md-select-option value="DE"><div slot="headline">DE</div></md-select-option>
                <md-select-option value="FL"><div slot="headline">FL</div></md-select-option>
                <md-select-option value="GA"><div slot="headline">GA</div></md-select-option>
                <md-select-option value="HI"><div slot="headline">HI</div></md-select-option>
                <md-select-option value="ID"><div slot="headline">ID</div></md-select-option>
                <md-select-option value="IL"><div slot="headline">IL</div></md-select-option>
                <md-select-option value="IN"><div slot="headline">IN</div></md-select-option>
                <md-select-option value="IA"><div slot="headline">IA</div></md-select-option>
                <md-select-option value="KS"><div slot="headline">KS</div></md-select-option>
                <md-select-option value="KY"><div slot="headline">KY</div></md-select-option>
                <md-select-option value="LA"><div slot="headline">LA</div></md-select-option>
                <md-select-option value="ME"><div slot="headline">ME</div></md-select-option>
                <md-select-option value="MD"><div slot="headline">MD</div></md-select-option>
                <md-select-option value="MA"><div slot="headline">MA</div></md-select-option>
                <md-select-option value="MI"><div slot="headline">MI</div></md-select-option>
                <md-select-option value="MN"><div slot="headline">MN</div></md-select-option>
                <md-select-option value="MS"><div slot="headline">MS</div></md-select-option>
                <md-select-option value="MO"><div slot="headline">MO</div></md-select-option>
                <md-select-option value="MT"><div slot="headline">MT</div></md-select-option>
                <md-select-option value="NE"><div slot="headline">NE</div></md-select-option>
                <md-select-option value="NV"><div slot="headline">NV</div></md-select-option>
                <md-select-option value="NH"><div slot="headline">NH</div></md-select-option>
                <md-select-option value="NJ"><div slot="headline">NJ</div></md-select-option>
                <md-select-option value="NM"><div slot="headline">NM</div></md-select-option>
                <md-select-option value="NY"><div slot="headline">NY</div></md-select-option>
                <md-select-option value="NC"><div slot="headline">NC</div></md-select-option>
                <md-select-option value="ND"><div slot="headline">ND</div></md-select-option>
                <md-select-option value="OH"><div slot="headline">OH</div></md-select-option>
                <md-select-option value="OK"><div slot="headline">OK</div></md-select-option>
                <md-select-option value="OR"><div slot="headline">OR</div></md-select-option>
                <md-select-option value="PA"><div slot="headline">PA</div></md-select-option>
                <md-select-option value="RI"><div slot="headline">RI</div></md-select-option>
                <md-select-option value="SC"><div slot="headline">SC</div></md-select-option>
                <md-select-option value="SD"><div slot="headline">SD</div></md-select-option>
                <md-select-option value="TN"><div slot="headline">TN</div></md-select-option>
                <md-select-option value="TX"><div slot="headline">TX</div></md-select-option>
                <md-select-option value="UT"><div slot="headline">UT</div></md-select-option>
                <md-select-option value="VT"><div slot="headline">VT</div></md-select-option>
                <md-select-option value="VA"><div slot="headline">VA</div></md-select-option>
                <md-select-option value="WA"><div slot="headline">WA</div></md-select-option>
                <md-select-option value="WV"><div slot="headline">WV</div></md-select-option>
                <md-select-option value="WI"><div slot="headline">WI</div></md-select-option>
                <md-select-option value="WY"><div slot="headline">WY</div></md-select-option>
              </md-outlined-select>
            </div>
            <div class="grid-2">
              <md-outlined-select id="country" label="Country" required>
                <md-select-option value="US" selected><div slot="headline">US</div></md-select-option>
              </md-outlined-select>
              <md-outlined-text-field id="zip" label="ZIP" required></md-outlined-text-field>
            </div>
          </fieldset>

          <fieldset>
            <legend>Legal Sex *</legend>
            <div class="radio-group">
              <label><md-radio name="sex" value="M"></md-radio> Male</label>
              <label><md-radio name="sex" value="F"></md-radio> Female</label>
            </div>
            <p id="sexError" class="error-msg" aria-live="polite"></p>
          </fieldset>


          <fieldset>
            <legend>Date of Birth *</legend>
            <div class="dob-row" role="group" aria-label="Date of birth">
              <md-outlined-select id="dobMonth" label="Month" required>
                <md-select-option value="1"><div slot="headline">1</div></md-select-option>
                <md-select-option value="2"><div slot="headline">2</div></md-select-option>
                <md-select-option value="3"><div slot="headline">3</div></md-select-option>
                <md-select-option value="4"><div slot="headline">4</div></md-select-option>
                <md-select-option value="5"><div slot="headline">5</div></md-select-option>
                <md-select-option value="6"><div slot="headline">6</div></md-select-option>
                <md-select-option value="7"><div slot="headline">7</div></md-select-option>
                <md-select-option value="8"><div slot="headline">8</div></md-select-option>
                <md-select-option value="9"><div slot="headline">9</div></md-select-option>
                <md-select-option value="10"><div slot="headline">10</div></md-select-option>
                <md-select-option value="11"><div slot="headline">11</div></md-select-option>
                <md-select-option value="12"><div slot="headline">12</div></md-select-option>
              </md-outlined-select>
              <md-outlined-select id="dobDay" label="Day" required>
                <md-select-option value="1"><div slot="headline">1</div></md-select-option>
                <md-select-option value="2"><div slot="headline">2</div></md-select-option>
                <md-select-option value="3"><div slot="headline">3</div></md-select-option>
                <md-select-option value="4"><div slot="headline">4</div></md-select-option>
                <md-select-option value="5"><div slot="headline">5</div></md-select-option>
                <md-select-option value="6"><div slot="headline">6</div></md-select-option>
                <md-select-option value="7"><div slot="headline">7</div></md-select-option>
                <md-select-option value="8"><div slot="headline">8</div></md-select-option>
                <md-select-option value="9"><div slot="headline">9</div></md-select-option>
                <md-select-option value="10"><div slot="headline">10</div></md-select-option>
                <md-select-option value="11"><div slot="headline">11</div></md-select-option>
                <md-select-option value="12"><div slot="headline">12</div></md-select-option>
                <md-select-option value="13"><div slot="headline">13</div></md-select-option>
                <md-select-option value="14"><div slot="headline">14</div></md-select-option>
                <md-select-option value="15"><div slot="headline">15</div></md-select-option>
                <md-select-option value="16"><div slot="headline">16</div></md-select-option>
                <md-select-option value="17"><div slot="headline">17</div></md-select-option>
                <md-select-option value="18"><div slot="headline">18</div></md-select-option>
                <md-select-option value="19"><div slot="headline">19</div></md-select-option>
                <md-select-option value="20"><div slot="headline">20</div></md-select-option>
                <md-select-option value="21"><div slot="headline">21</div></md-select-option>
                <md-select-option value="22"><div slot="headline">22</div></md-select-option>
                <md-select-option value="23"><div slot="headline">23</div></md-select-option>
                <md-select-option value="24"><div slot="headline">24</div></md-select-option>
                <md-select-option value="25"><div slot="headline">25</div></md-select-option>
                <md-select-option value="26"><div slot="headline">26</div></md-select-option>
                <md-select-option value="27"><div slot="headline">27</div></md-select-option>
                <md-select-option value="28"><div slot="headline">28</div></md-select-option>
                <md-select-option value="29"><div slot="headline">29</div></md-select-option>
                <md-select-option value="30"><div slot="headline">30</div></md-select-option>
                <md-select-option value="31"><div slot="headline">31</div></md-select-option>
              </md-outlined-select>
              <md-outlined-text-field id="dobYear" label="Year" inputmode="numeric" pattern="\d{4}" required></md-outlined-text-field>
            </div>
          </fieldset>

          <fieldset>
            <legend>Reason for Visit *</legend>
            <div class="radio-group">
              <label><md-radio name="reason" value="urgent"></md-radio> In-Person Urgent Care Visit</label>
              <label><md-radio name="reason" value="primary"></md-radio> Primary Care (Please call to schedule)</label>
              <label><md-radio name="reason" value="sports"></md-radio> Sports Physical</label>
              <label><md-radio name="reason" value="labs"></md-radio> Required Bloodwork/Imaging</label>
              <label><md-radio name="reason" value="tele"></md-radio> Video Telehealth Appointment</label>
              <label><md-radio name="reason" value="immigration"></md-radio> Immigration Exam (Call First)</label>
            </div>
            <p id="reasonError" class="error-msg" aria-live="polite"></p>
          </fieldset>


          <label for="insurance" class="section-title" style="font-size:14px;font-weight:600">What is the name of your insurance (include secondary insurance, if applicable)? If you don't have insurance, put none.</label>
          <md-outlined-text-field id="insurance" label="Insurance name *" required></md-outlined-text-field>

          <label for="details" class="section-title" style="font-size:14px;font-weight:600">If visiting for urgent care, briefly describe what's wrong:</label>
          <textarea id="details" rows="3" placeholder="Optional details"></textarea>

          <md-filled-button id="scheduleBtn" disabled>Schedule Appointment</md-filled-button>
        </form>
      </div>

      <!-- Step 4: Confirmation -->
      <div id="step4" hidden>
        <div class="confirm">
          <div class="confirm-icon" aria-hidden="true">
            <span>✓</span>
          </div>
          <h2>Appointment Scheduled!</h2>
          <p class="helper lead">Your appointment has been successfully scheduled.</p>

          <div class="confirm-card">
            <div class="row">
              <span aria-hidden="true">📅</span>
              <div>
                <div class="helper">Date &amp; Time</div>
                <div id="confirmWhen" class="value">&nbsp;</div>
              </div>
            </div>
            <div class="row">
              <span aria-hidden="true">✉️</span>
              <div>
                <div class="helper">Confirmation sent to</div>
                <div id="confirmEmail" class="value">&nbsp;</div>
              </div>
            </div>
          </div>

          <div class="confirm-banner">
            You'll receive a confirmation email with the appointment details.
          </div>

          <md-text-button id="scheduleAnother" type="button">📅 Schedule Another Appointment</md-text-button>
        </div>
      </div></section>
  </main>

  <script>
    // ===== Element refs =====
    const monthLabel=document.getElementById('monthLabel');
    const daysGrid=document.getElementById('days');
    const slotList=document.getElementById('slotList');
    const slotDateHeading=document.getElementById('slotDateHeading');
    const apptSummary=document.getElementById('apptSummary');
    const prevBtn=document.getElementById('prev');
    const nextBtn=document.getElementById('next');
            const backTop=document.getElementById('backTop');
    let currentStep = 1;

    // Step 4 refs
    const confirmWhen = document.getElementById('confirmWhen');
    const confirmEmail = document.getElementById('confirmEmail');
    const scheduleAnother = document.getElementById('scheduleAnother');

    // Step 3 refs
    const patientForm = document.getElementById('patientForm');
    const scheduleBtn = document.getElementById('scheduleBtn');
    const dobMonthEl = document.getElementById('dobMonth');
    const dobDayEl   = document.getElementById('dobDay');
    const dobYearEl  = document.getElementById('dobYear');

    // ===== State =====
    let viewYear=2025, viewMonth=7; // August 2025
    window.selectedDateISO=null;
    window.selectedSlot=null;

    // Business hours (edit here to change slot window)
    const BUSINESS_START_HOUR = 8;  // 8:00 AM
    const BUSINESS_END_HOUR   = 20;  // 8:00 PM

    // Centralized config
    const SLOT_INTERVAL_MIN   = 15; // minutes between slots
    const SLOT_KEEP_RATIO_MOD = 2;  // keep ~1/mod slots (2=50%, 3=66%, 5=80%)
    const DISABLE_WEEKENDS    = false;

    // ===== Helpers =====
    function formatToAmPm(timeStr) {
      const [hStr, mStr] = String(timeStr).split(":");
      let h = parseInt(hStr, 10);
      const ampm = h >= 12 ? 'PM' : 'AM';
      h = h % 12; if (h === 0) h = 12;
      return `${h}:${mStr || '00'} ${ampm}`;
    }

    // Friendly full-date formatter used across UI
    

    // Local date helpers (avoid UTC shifts for YYYY-MM-DD)
    const DATE_FMT = { weekday:'long', year:'numeric', month:'long', day:'numeric' };
    function parseYMDLocal(ymd){
      const [y,m,d] = ymd.split('-').map(Number);
      return new Date(y, m-1, d);
    }
    function friendlyDateLocal(ymdOrDate){
      if (typeof ymdOrDate === 'string' && /^\d{4}-\d{2}-\d{2}$/.test(ymdOrDate)){
        return parseYMDLocal(ymdOrDate).toLocaleDateString(undefined, DATE_FMT);
      }
      return new Date(ymdOrDate).toLocaleDateString(undefined, DATE_FMT);
    }

    // Mock availability: only from today onwards
    function mockDayHasAvailability(dateObj){
      // Only allow availability for today or future dates
      const d = new Date(dateObj); d.setHours(0,0,0,0);
      const today = new Date(); today.setHours(0,0,0,0);
      if (DISABLE_WEEKENDS && [0,6].includes(d.getDay())) return false;
      if (d < today) return false;
      // Simple deterministic pattern so not every day is available
      const seed = d.getFullYear()*10000 + (d.getMonth()+1)*100 + d.getDate();
      return (seed % 5) !== 0; // ~80% of future days available
    }

    // 15‑minute slots within business hours; filter to ~50% available; today starts from next quarter hour
    function generateSlotsForDate(iso){
      const date = parseYMDLocal(iso);
      const now  = new Date();
      const start = new Date(date); start.setHours(BUSINESS_START_HOUR, 0, 0, 0);
      const end   = new Date(date); end.setHours(BUSINESS_END_HOUR,   0, 0, 0);
      let cursor = new Date(start);
      if (date.toDateString() === now.toDateString()){
        const next = new Date(now);
        const addMin = (SLOT_INTERVAL_MIN - (next.getMinutes() % SLOT_INTERVAL_MIN)) % SLOT_INTERVAL_MIN;
        next.setMinutes(next.getMinutes() + addMin, 0, 0);
        if (next > cursor) cursor = next;
      }
      const all = [];
      while (cursor <= end){ all.push(new Date(cursor)); cursor = new Date(cursor.getTime() + SLOT_INTERVAL_MIN*60*1000); }
      const available = all.filter(dt => {
        const seed = date.getFullYear()*10000 + (date.getMonth()+1)*100 + date.getDate() + dt.getHours()*60 + dt.getMinutes();
        return (seed % SLOT_KEEP_RATIO_MOD) !== 0; // keep ~1/mod slots
      });
      const list = (available.length ? available : all.slice(0, Math.min(3, all.length)))
        .map(dt => formatToAmPm(`${String(dt.getHours()).padStart(2,'0')}:${String(dt.getMinutes()).padStart(2,'0')}`));
      return list;
    }

    function renderSlots(iso){
      // Render the Step 2 list of time slots for a given YYYY-MM-DD d
      slotDateHeading.textContent = friendlyDateLocal(iso);
      slotList.innerHTML = '';

      const slots = generateSlotsForDate(iso);
      if (!slots.length){
        const p = document.createElement('p');
        p.className = 'helper';
        p.textContent = 'No times remaining for this date.';
        slotList.appendChild(p);
        return;
      }

      slots.forEach((t) => {
        const b = document.createElement('button');
        b.className = 'slot-btn';
        b.innerHTML = '<span class="txt">' + t + '</span>';
        b.addEventListener('click', () => {
          window.selectedSlot = t;
          apptSummary.textContent = friendlyDateLocal(iso) + ' at ' + t;
          gotoStep(3);
          if (typeof updateValidity === 'function') updateValidity();
        });
        slotList.appendChild(b);
      });
    }

// Step 3 helpers: populate DOB selects and validate form (Canvas-safe)
function daysInMonth(y,m){ const yy=Number(y)||new Date().getFullYear(); const mm=(Number(m)||1)-1; return new Date(yy,mm+1,0).getDate(); }
function populateMonths(){ /* pre-populated in HTML */ }

function capDaysForMonthYear(){
  const dayEl = document.getElementById('dobDay');
  const yearEl = document.getElementById('dobYear');
  const monthEl = document.getElementById('dobMonth');
  if(!dayEl) return;
  const y = (yearEl?.value || new Date().getFullYear());
  const m = (monthEl?.value || 1);
  const max = daysInMonth(y,m);
  // Disable days beyond max
  const opts = Array.from(dayEl.querySelectorAll('md-select-option'));
  opts.forEach((opt, idx) => {
    const d = idx+1;
    if (d > max) opt.setAttribute('disabled','');
    else opt.removeAttribute('disabled');
  });
  if (dayEl.value && Number(dayEl.value) > max) dayEl.value = '';
}

    
function gv(id){ const el=document.getElementById(id); return (el && el.value ? String(el.value).trim() : ''); }
function setFieldError(id, ok, msg){
  const el = document.getElementById(id);
  if(!el) return;
  if(ok){ el.removeAttribute('error'); el.removeAttribute('error-text'); }
  else { el.setAttribute('error',''); el.setAttribute('error-text', msg); }
}
function setTextError(id, ok, msg){
  const p = document.getElementById(id);
  if(!p) return;
  p.textContent = ok ? '' : msg;
}
    
function updateValidity(){
  const btn = document.getElementById('scheduleBtn');
  if(!btn) return;
  const v = gv;

  const firstOk = !!v('firstName'); setFieldError('firstName', firstOk, 'First name is required');
  const lastOk  = !!v('lastName');  setFieldError('lastName',  lastOk,  'Last name is required');

  const emailOk = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v('email')); setFieldError('email', emailOk, 'Enter a valid email');

  const addrOk  = !!v('addr1'); setFieldError('addr1', addrOk, 'Street address is required');
  const cityOk  = !!v('city');  setFieldError('city',  cityOk,  'City is required');
  const stateOk = !!v('state'); setFieldError('state', stateOk, 'Select a state');

  const zipOk = /^\d{5}(-\d{4})?$/.test(v('zip')); setFieldError('zip', zipOk, 'Enter ZIP (5 digits or ZIP+4)');

  const insOk = !!v('insurance'); setFieldError('insurance', insOk, 'Enter insurance or "none"');

  const sexOk = Array.from(document.querySelectorAll('md-radio[name="sex"]')).some(r => r.checked);
  setTextError('sexError', sexOk, 'Please select Legal Sex');

  const reasonOk = Array.from(document.querySelectorAll('md-radio[name="reason"]')).some(r => r.checked);
  setTextError('reasonError', reasonOk, 'Please select a reason');

  const yearOk = /^\d{4}$/.test(v('dobYear')); setFieldError('dobYear', yearOk, 'Enter a 4-digit year');
  const monthOk = !!v('dobMonth'); setFieldError('dobMonth', monthOk, 'Select month'); const dayOk   = !!v('dobDay');   setFieldError('dobDay',   dayOk,   'Select day');

  const ccVal = document.getElementById('countryCode')?.value || '';
  const ccOk  = !!ccVal; setFieldError('countryCode', ccOk, 'Select country code'); const phoneDigits = (v('phone').replace(/\D/g,''));
  const phoneOk = ccOk ? (ccVal === '+1' ? phoneDigits.length === 10 : phoneDigits.length >= 6) : false;
  setFieldError('phone', phoneOk, 'Enter a valid phone number');

  const stepOk = !!(window.selectedDateISO && window.selectedSlot);

  const allOk = firstOk && lastOk && emailOk && addrOk && cityOk && stateOk && zipOk && insOk &&
                sexOk && reasonOk && yearOk && monthOk && dayOk && ccOk && phoneOk && stepOk;
  btn.disabled = !allOk;
}


// Initialize Step 3 once when shown

    function updateProgress(n){
      const c1=document.getElementById('circle1');
      const c2=document.getElementById('circle2');
      const c3=document.getElementById('circle3');
      const c4=document.getElementById('circle4');
      const l1=document.getElementById('line1');
      const l2=document.getElementById('line2');
      const l3=document.getElementById('line3');
      [c1,c2,c3,c4,l1,l2,l3].forEach(el=>el && el.classList.remove('active'));
      if(n>=1){ c1?.classList.add('active'); }
      if(n>=2){ c2?.classList.add('active'); l1?.classList.add('active'); }
      if(n>=3){ c3?.classList.add('active'); l2?.classList.add('active'); }
      if(n>=4){ c4?.classList.add('active'); l3?.classList.add('active'); }
    }

    function gotoStep(n){
      document.getElementById('step1').hidden = n!==1;
      document.getElementById('step2').hidden = n!==2;
      document.getElementById('step3').hidden = n!==3;
      document.getElementById('step4').hidden = n!==4;
      currentStep = n;
      if (backTop){
        if (n === 1 || n === 4){ backTop.hidden = true; backTop.style.display = 'none'; }
        else { backTop.hidden = false; backTop.style.display = 'inline-flex'; }
      }

      updateProgress(n);

      // a11y: move focus to current step title for screen readers/keyboard users
      const stepTitle = document.querySelector(`#step${n} > h2`);
      if (stepTitle){ stepTitle.setAttribute('tabindex','-1'); stepTitle.focus(); }
    }

    // ===== Calendar =====
    function renderMonth() {
      monthLabel.textContent=new Date(viewYear,viewMonth,1).toLocaleDateString(undefined,{month:'long',year:'numeric'});
      const firstWeekday=new Date(viewYear,viewMonth,1).getDay();
      const daysInMonth=new Date(viewYear,viewMonth+1,0).getDate();
      daysGrid.innerHTML='';
      for(let i=0;i<firstWeekday;i++){daysGrid.appendChild(document.createElement('div'))}
      const today = new Date(); today.setHours(0,0,0,0);
      for(let d=1;d<=daysInMonth;d++){
        const btn=document.createElement('button');
        btn.type='button';
        const dateObj = new Date(viewYear,viewMonth,d);
                const isAvail = mockDayHasAvailability(dateObj);
        btn.textContent=d;btn.className='daybtn';
        btn.setAttribute('aria-label', dateObj.toDateString() + (isAvail ? ' — Available' : ' — Unavailable'));
        if (!isAvail) {
          btn.disabled = true;
        } else {
          btn.addEventListener('click',()=>{
            window.selectedDateISO = `${dateObj.getFullYear()}-${String(dateObj.getMonth()+1).padStart(2,'0')}-${String(dateObj.getDate()).padStart(2,'0')}`;
            renderSlots(window.selectedDateISO);
            gotoStep(2);
          });
        }
        daysGrid.appendChild(btn);
      }
    }

    prevBtn.addEventListener('click',()=>{viewMonth--;if(viewMonth<0){viewMonth=11;viewYear--;}renderMonth()});
    nextBtn.addEventListener('click',()=>{viewMonth++;if(viewMonth>11){viewMonth=0;viewYear++;}renderMonth()});
            backTop?.addEventListener('click', ()=>{ if (currentStep===3) gotoStep(2); else gotoStep(1); });

    // Step 3 listeners (unconditional)
    document.getElementById('dobMonth')?.addEventListener('change', ()=>{ capDaysForMonthYear(); updateValidity(); });
    document.getElementById('dobYear')?.addEventListener('input',  ()=>{ capDaysForMonthYear(); updateValidity(); });
    document.getElementById('patientForm')?.addEventListener('input',  updateValidity);
    document.getElementById('patientForm')?.addEventListener('change', updateValidity);
    document.querySelectorAll('md-radio[name="sex"], md-radio[name="reason"]').forEach(r=> r.addEventListener('change', updateValidity));
    document.getElementById('countryCode')?.addEventListener('change', updateValidity);
    document.getElementById('state')?.addEventListener('change', updateValidity);

    // Init calendar and validity
    renderMonth();
    gotoStep(1);
    capDaysForMonthYear();
    updateValidity();
    // Handle scheduling: prevent default form submit, populate confirmation, go to Step 4
    scheduleBtn?.addEventListener('click', (e)=>{
      e.preventDefault();
      if (scheduleBtn.disabled) return;
      const whenTxt = friendlyDateLocal(window.selectedDateISO) + (window.selectedSlot?(' at '+window.selectedSlot):'');
      if (confirmWhen) confirmWhen.textContent = whenTxt;
      if (confirmEmail) confirmEmail.textContent = (document.getElementById('email')?.value||'').trim();
      gotoStep(4);
    });

    scheduleAnother?.addEventListener('click', ()=>{ window.selectedDateISO=null; window.selectedSlot=null; gotoStep(1); updateProgress(1); });

    
  </script>
</body>
</html>
